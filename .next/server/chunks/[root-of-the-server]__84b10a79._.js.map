{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///workspace/demo-gallery/src/app/api/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { writeFile, mkdir } from \"fs/promises\";\nimport { existsSync } from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\n// Ensure uploads directory exists\nasync function ensureUploadsDir() {\n  const uploadsDir = path.join(process.cwd(), \"public\", \"uploads\");\n  if (!existsSync(uploadsDir)) {\n    await mkdir(uploadsDir, { recursive: true });\n  }\n  return uploadsDir;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData();\n    const files = formData.getAll(\"files\") as File[];\n\n    if (!files || files.length === 0) {\n      return NextResponse.json(\n        { error: \"No files provided\" },\n        { status: 400 }\n      );\n    }\n\n    const uploadsDir = await ensureUploadsDir();\n    const uploadedFiles = [];\n\n    for (const file of files) {\n      if (file.size === 0) continue;\n\n      // Validate file type\n      const isValidType = file.type.startsWith(\"image/\") || file.type.startsWith(\"video/\");\n      if (!isValidType) {\n        continue; // Skip invalid files\n      }\n\n      // Generate unique filename\n      const fileExtension = path.extname(file.name);\n      const uniqueId = nanoid();\n      const fileName = `${uniqueId}${fileExtension}`;\n      const filePath = path.join(uploadsDir, fileName);\n\n      // Convert file to buffer and write to disk\n      const buffer = Buffer.from(await file.arrayBuffer());\n      await writeFile(filePath, buffer);\n\n      // Create media item object\n      const mediaItem = {\n        id: uniqueId,\n        type: file.type.startsWith(\"image/\") ? \"image\" : \"video\",\n        src: `/uploads/${fileName}`,\n        title: file.name.replace(fileExtension, \"\"),\n        description: `Uploaded ${file.type.startsWith(\"image/\") ? \"image\" : \"video\"}`,\n        createdAt: new Date().toISOString(),\n        size: file.size,\n        originalName: file.name,\n      };\n\n      uploadedFiles.push(mediaItem);\n    }\n\n    return NextResponse.json({\n      success: true,\n      files: uploadedFiles,\n      count: uploadedFiles.length,\n    });\n  } catch (error) {\n    console.error(\"Upload error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to upload files\" },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,kCAAkC;AAClC,eAAe;IACb,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;IACtD,IAAI,CAAC,IAAA,2GAAU,EAAC,aAAa;QAC3B,MAAM,IAAA,8HAAK,EAAC,YAAY;YAAE,WAAW;QAAK;IAC5C;IACA,OAAO;AACT;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,QAAQ,SAAS,MAAM,CAAC;QAE9B,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG;YAChC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM;QACzB,MAAM,gBAAgB,EAAE;QAExB,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,KAAK,IAAI,KAAK,GAAG;YAErB,qBAAqB;YACrB,MAAM,cAAc,KAAK,IAAI,CAAC,UAAU,CAAC,aAAa,KAAK,IAAI,CAAC,UAAU,CAAC;YAC3E,IAAI,CAAC,aAAa;gBAChB,UAAU,qBAAqB;YACjC;YAEA,2BAA2B;YAC3B,MAAM,gBAAgB,4GAAI,CAAC,OAAO,CAAC,KAAK,IAAI;YAC5C,MAAM,WAAW,IAAA,2JAAM;YACvB,MAAM,WAAW,GAAG,WAAW,eAAe;YAC9C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY;YAEvC,2CAA2C;YAC3C,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM,KAAK,WAAW;YACjD,MAAM,IAAA,kIAAS,EAAC,UAAU;YAE1B,2BAA2B;YAC3B,MAAM,YAAY;gBAChB,IAAI;gBACJ,MAAM,KAAK,IAAI,CAAC,UAAU,CAAC,YAAY,UAAU;gBACjD,KAAK,CAAC,SAAS,EAAE,UAAU;gBAC3B,OAAO,KAAK,IAAI,CAAC,OAAO,CAAC,eAAe;gBACxC,aAAa,CAAC,SAAS,EAAE,KAAK,IAAI,CAAC,UAAU,CAAC,YAAY,UAAU,SAAS;gBAC7E,WAAW,IAAI,OAAO,WAAW;gBACjC,MAAM,KAAK,IAAI;gBACf,cAAc,KAAK,IAAI;YACzB;YAEA,cAAc,IAAI,CAAC;QACrB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;YACP,OAAO,cAAc,MAAM;QAC7B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}